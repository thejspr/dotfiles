#!/usr/bin/env ruby

INTERVAL = 10

duration = ARGV.any? ? ARGV.first.to_i : 30

Kernel.trap( "INT" ) { say('Woah! Where are you going?'); exit(0) }

def say(msg, options = {})
  options.merge!({ '-n' => 'Pomodoro' })
  puts "#{Time.now.strftime('%H:%M')} - #{msg}"
  system("growlnotify #{options.to_a.join(' ')} -m '#{msg}'")
end

say("Starting a #{duration} minutes long pomodoro. Have fun!")

while duration > 0 do
  sleep 60*INTERVAL
  duration -= INTERVAL
  say("#{duration} minutes left") if (duration > 0 && duration % INTERVAL == 0)
end

say("Pomodoro ended. Now go do something else. Great work!", { '-sticky' => true })
