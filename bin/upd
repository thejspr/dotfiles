#!/usr/bin/env bash

branch="$(git rev-parse --abbrev-ref HEAD)"

# code
[ -d .git ] && git co master && git pull && git remote prune origin && git bclean

# runtimes
[ -f .tool-versions ] && asdf install

# dependencies
[ -f Gemfile ] && bundle install
[ -f yarn.lock ] && yarn install

# data
[ -d db/migrate ] && rails db:migrate
[ -d db/data ] && rails db:migrate
[[ "$PWD" =~ peanutweb ]] && RAILS_ENV=test rails db:migrate db:data

git checkout $branch
