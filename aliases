# new stuff

[ ! "$(command -v dokku)" ] && alias dokku='$HOME/.dokku/contrib/dokku_client.sh'
alias myip='dig +short myip.opendns.com @resolver1.opendns.com'
alias open='xdg-open'
alias ghs='gh copilot suggest'
alias ghe='gh copilot explain'
alias en='e ~/.config/niri/config.kdl'
alias cl='claude'
alias cc='claude --continue'
alias cld='claude --dangerously-skip-permissions'
alias ccd='claude --continue --dangerously-skip-permissions'
alias dc='docker compose'

#system
alias e='$EDITOR'
alias kf='kill -9 %1'
alias tma='tmux attach'

# edit existing command or create a new script
function ew() {
  if [[ -f `which "$1"` ]]; then
    e `which "$1"`
  else
    echo "#!/usr/bin/env " > ~/clearhaus/bin/"$1"
    chmod +x ~/clearhaus/bin/"$1"
    e ~/clearhaus/bin/"$1"
  fi
}

alias pbcopy="wl-copy"
alias pbpaste="wl-paste"

#ruby
alias rv='ruby --version'
alias be='bundle exec'

#ubuntu
if [ "$(command -v apt)" ]; then
  alias aptu='sudo apt update && sudo apt upgrade'
  alias apti='sudo apt install'
  alias aptr='sudo apt remove'
  alias aptf='sudo apt-cache search'
fi

#rails
alias rs='rails s'
alias ragm='rails g migration'
alias rc='rails c'
alias migrate='rails db:migrate'
alias upgrade_gems="bundle update && rspec && git add -A && git commit -m 'Gem upgrades' && git push"
alias bef='foreman start -f Procfile.dev'
alias rt='rake -T'
alias rr='rails routes'

#testing
alias specs='rspec --tag ~type:feature'
alias fspecs='rspec --tag type:feature'
alias aspecs='fspecs && specs'
alias fails='rspec --only-failures'

#git
# unalias g
# g() {
#   if [[ $# -eq 0 ]]; then
#     command hub status -sb
#   else
#     command hub "$@";
#   fi
# }
unalias gbr 2>/dev/null # exists in bin
[ "$(command -v gcam)" ] && unalias gcam
gcam() {
  command git add -A;
  command git commit -m "$*";
}
gpush() {
  command git add -A;
  command git commit -m "$*";
  command git push
}
alias cp-head='git rev-parse --short HEAD | pbcopy'
alias b='gbr'
alias gb='git branch'
alias gbX='git branch --delete --force'
alias gbx='git branch --delete'
alias gc='git c'
alias gca='git ca'
alias gd='git d'
alias ge='g edit'
alias gg='git grep'
alias gl='git l'
alias gp='git push'
alias gpf='FORCE=1 git push --force-with-lease --no-verify'
alias gs='git status -sb'
alias lg='lazygit'
alias lz='lazygit'

#msc
alias cd..='cd ..'
if [ "$(command -v eza)" ]; then
  alias ls='eza'
  alias ll='eza -l'
  alias la='eza -a'
fi
alias -g G='|rg'
[ "$(command -v bat)" ] && alias cat='bat'

#system and files editing
alias ea='e ~/.aliases'
alias eaa='e ~/.config/alacritty/alacritty.toml'
alias egg='e ~/.config/ghostty/config'
alias eg='e ~/.gitconfig'
alias es='e ~/.ssh/config'
alias et='e ~/dotfiles/tmux.conf'
alias ez='e ~/dotfiles/zsh_mods'
alias ezz='e ~/.zshrc'
alias se='sudo -E nvim'
alias sr='exec zsh'

# https://gist.github.com/dhh/18575558fc5ee10f15b6cd3e108ed844
# Create a new worktree and branch from within current git directory.
gawc() {
  if [[ -z "$1" ]]; then
    echo "Usage: ga [branch name]"
    exit 1
  fi

  local branch="$1"
  local base="$(basename "$PWD")"
  local worktree_path="../${base}--${branch}"

  git worktree add -b "$branch" "$worktree_path"
  mise trust "$worktree_path"
  cd "$worktree_path"
}

# Remove worktree and branch from within active worktree directory.
gdwc() {
  if gum confirm "Remove worktree and branch?"; then
    local cwd base branch root

    cwd="$(pwd)"
    worktree="$(basename "$cwd")"

    # split on first `--`
    root="${worktree%%--*}"
    branch="${worktree#*--}"

    # Protect against accidentially nuking a non-worktree directory
    if [[ "$root" != "$worktree" ]]; then
      cd "../$root"
      git worktree remove "$worktree" --force
      git branch -D "$branch"
    fi
  fi
}
