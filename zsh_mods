# zmodload zsh/zprof # uncomment for zsh startup testing `time  zsh -i -c exit`
export HISTCONTROL=ignoreboth:erasedups
export EDITOR='vim'
export BUNDLER_EDITOR='vim'
export PATH="$PATH:`yarn global bin`"
export PATH="$PATH:$PWD/bin:/home/jesper/.local/bin"
export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!.git/*"'
export LESS='-F -g -i -M -R -S -w -X -z-4'
export ERL_AFLAGS="-kernel shell_history enabled"

autoload zmv
bindkey -e
compdef g=git
fpath=(/usr/local/share/zsh-completions $fpath)
unalias gbr

if [[ -v MAC ]]; then
  export SHELL=/usr/local/bin/zsh
  export PATH=/usr/local/bin:/usr/local/share/npm/bin:$PATH
  export PATH=./bin:~/bin:/Applications/Postgres.app/Contents/Versions/latest/bin:$PATH
  export GOROOT=/usr/local/opt/go/libexec
  alias tar='/usr/local/bin/gtar'

  export NVM_DIR="$HOME/.nvm"
  [ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh" --no-use  # This loads nvm
else
  export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
  [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" --no-use # This loads nvm
  export PATH="$PATH:/home/jesper/apps/swift/usr/bin"
  # xmodmap ~/.Xmodmap
fi

source ~/.z.sh/z.sh

# Ruby
export PATH="$HOME/.rbenv/bin:$PATH"
eval "$(rbenv init -)"
export RUBY_BUILD_CACHE_PATH=true
export RUBY_HEAP_SLOTS_INCREMENT=10000
export RUBY_HEAP_SLOTS_GROWTH_FACTOR=1.8
export RUBY_GC_MALLOC_LIMIT=59000000
export RUBY_HEAP_FREE_MIN=100000

# Go
export GOPATH=$HOME/golang
export PATH=$PATH:$GOPATH/bin
export PATH=$PATH:$GOROOT/bin

# hub alias
eval "$(hub alias -s)"

# Alias and function definitions.
. ~/.aliases

fancy-ctrl-z () {
  if [[ $#BUFFER -eq 0 ]]; then
    BUFFER="fg"
    zle accept-line
  else
    zle push-input
    zle clear-screen
  fi
}
zle -N fancy-ctrl-z
bindkey '^Z' fancy-ctrl-z

source ~/.secrets

# new stuff
source ~/.zsh/zsh-peco-history/zsh-peco-history.zsh

GPG_TTY=$(tty)
export GPG_TTY
# zprof
